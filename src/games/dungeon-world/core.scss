@use 'sass:math';

@import "../../css/utils.scss";
@import url(//db.onlinewebfonts.com/c/6bd1a3591c8b61e9715642ccae7e9418?family=Newcomen+Black);
@import url(//db.onlinewebfonts.com/c/fe9c236a1c142788cb16ec5238c7833e?family=Minion+Pro);

$stats-color: #101E33;
$field-background: #172022;
$collection-item-color: #202d31;

.dungeon-world.core {
  .field[name='trigger'], .field[name='procedure'] { @extend %invisible; }
}

.home.page .character.dungeon-world-core {
  position: relative;
  @extend %game-badge;

  &::before { background-image: url('./images/symbol.jpg'); }

  display: grid;
  grid-template: 1fr 1fr / 0fr 0fr 1fr;
  grid-column-gap: $small-gap;
  grid-template-areas:
    "name name name"
    "level race class";

  > .field { @extend %invisible; }

  > .field[name=name] {
    grid-area: name;
    @extend %visible, %title-text, %show-value;
  }


  > .field[name=level] {
    grid-area: level;
    @extend %visible, %meta-text, %show-value;
    min-width: max-content;
    &::before { content: 'lvl. '; }
  }

  > .field[name=race] {
    grid-area: race;
    @extend %visible, %meta-text, %show-value;
  }

  > .field[name=playbook] {
    @extend %visible, %meta-text, %show-value;
    grid-area: class;
  }

  .settings { @extend %invisible; }

  &.thief {
    @extend %exact-background;
    background-image: url('./images/classes-icons/thief.png');
    background-position: right;
    background-color: #3f2167;
    color: white;
  }
}

.new.page {
  .choose.game .field[value*='dungeon-world'] {
    @extend %exact-background;
    background: url('./images/banner.jpg');
  }

 .dungeon-world.core .playbook .field {
    @extend %round, %show-value, %title-text;
    height: 5rem;
    margin: $large-gap;
    background: white;

    &::after { margin: $large-gap; }
  }

  &.dungeon-world.core {
    .choice.name .recommendations .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .assignment.choice.stat {
      .source, .target {
        > * {
          @extend %round;
          width: 5rem;
        }
      }

      .source {
        align-items: flex-start;
      }

      .target {
        align-items: flex-end;
      }
    }
  }
}

.character.page > .character.dungeon-world-core {
  @extend %page-size;

  display: grid;
  grid-template: 2.5rem repeat(12, 1fr) 2.5rem/repeat(3, 1fr) 5.5rem;
  gap: $small-gap;
  padding-left: $small-gap;
  padding-bottom: $small-gap;
  box-sizing: border-box;
  grid-template-areas:
    "name name name xp"
    "description description description strength"
    "playbook race alignment strength"
    "playbook race alignment dexterity"
    "bonds bonds bonds dexterity"
    "damage armor hp constitution"
    "damage armor hp constitution"
    "moves moves moves intelligence"
    "moves moves moves intelligence"
    "moves moves moves wisdom"
    "load load load wisdom"
    "gear gear gear charisma"
    "gear gear gear charisma"
    "gear gear gear settings";

  > .field {
    @extend %invisible;
    position: relative;
  }

  // -------------------- header --------------------

  > .field[name=name] {
    grid-area: name;
    @extend %flex-visible, %title-text, %show-value;
    margin-left: $large-gap;
    line-height: 2.5rem;
    color: white;
  }

  > .field[name=xp], > .field[name=level] {
    @extend %flex-visible;
    grid-area: xp;
  }

  > .field[name=xp] {
    @extend %round, %show-value;
    margin-bottom: $small-gap;
    margin-top: $large-gap;
    margin-right: $small-gap;
    background: black;

    &:after {
      position: absolute;
      z-index: 1;
      padding-left: 1.8rem;
      line-height: 1rem;
    }
  }

  $xp-color: #207400;
  $level-up-color: #e3a82e;
  $level-up-gradient: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%),
                radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%);
  $level-circle-size: 2rem;

  > .field[name=level] {
    @extend %show-value, %round;
    display: flex;
    justify-content: left;
    align-items: center;
    margin-left: $small-gap;
    margin-top: $small-gap;
    color: white;

    &::before {
      @extend %round;
      content: '';
      position: absolute;
      margin-left: -0.5rem;
      width: calc(#{$full} - #{$level-circle-size});
      height: 50%;
      padding-left: $level-circle-size;
      background: $level-up-gradient;
    }

    &::after {
      @extend %centering;
      z-index: 1;
      margin-left: #{math.div($level-circle-size, -2)};
      border: 2px solid $level-up-color;
      background: $background-color;
      width: $level-circle-size;
      aspect-ratio: 1;
      border-radius: $level-circle-size;
    }
  }

  @for $lvl from 1 through 20 {
    @for $xp from 0 through $lvl+6 {
      > .field[name=xp][value='#{$xp}'] { color: white; }
      > .field[name=xp][value='#{$xp}'] ~ .field[name=level][value='#{$lvl}'] {
        &::before {
          background: $xp-color !important;
          width: calc(#{math.div($xp, $lvl+7)*100}% - #{math.div($xp, $lvl+7)*2}rem);
        }
        &::after { border-color: $xp-color !important; }
      }
    }
  }

  // -------------------- stats --------------------

  > .field[name=strength],      > .field[name=str], > .field[name=weak]     { grid-area: strength; }
  > .field[name=dexterity],     > .field[name=dex], > .field[name=shakey]   { grid-area: dexterity; }
  > .field[name=constitution],  > .field[name=con], > .field[name=sick]     { grid-area: constitution; }
  > .field[name=intelligence],  > .field[name=int], > .field[name=stunned]  { grid-area: intelligence; }
  > .field[name=wisdom],        > .field[name=wis], > .field[name=confused] { grid-area: wisdom; }
  > .field[name=charisma],      > .field[name=cha], > .field[name=scarred]  { grid-area: charisma; }

  > .field[name=strength],
  > .field[name=dexterity],
  > .field[name=constitution],
  > .field[name=intelligence],
  > .field[name=wisdom],
  > .field[name=charisma] {
    @extend %flex-visible, %show-name, %show-value;
    background: $stats-color;
    font: 0.7rem 'Minion Pro';
    color: white;
    border-radius: 1rem 0 0 1rem;
    $padding: 0.2rem;

    &::before {
      position: absolute;
      text-transform: uppercase;
      bottom: $padding;
      text-align: center;
      width: $full;
    }

    &::after {
      position: absolute;
      top: 0;
      right: $padding;
    }
  }

  > .field[name=str],
  > .field[name=dex],
  > .field[name=con],
  > .field[name=int],
  > .field[name=wis],
  > .field[name=cha] {
    @extend %flex-visible, %centering, %show-value;
    font: 3rem 'Minion Pro';
    color: white;
  }

  > .field[name=weak],
  > .field[name=shakey],
  > .field[name=sick],
  > .field[name=stunned],
  > .field[name=confused],
  > .field[name=scarred] {
    @extend %flex-visible, %content-size, %stamp;

    &[value='true'] { @extend %show-name; }
  }

  // -------------------- information --------------------

  > .field[name=description] {
    @extend %flex-visible, %show-value, %oneline;
    grid-area: description;
    color: white;
    text-align: justify;
    line-height: 1em;
    margin-top: -#{$large-gap};
    padding-left: $large-gap;
    display: inline-block;
  }

  > .field[name=look] {
    @extend %flex-visible, %show-value, %oneline;
    grid-area: description;
    color: white;
    padding-top: $small-gap;
    padding-left: $large-gap;
  }

  > .field[name=playbook] {
    @extend %flex-visible, %centering;
    grid-area: playbook;
    > .field[name=name] {
      @extend %show-value, %full-size, %centering;
      flex-direction: column;
      gap: $tiny-gap;
      color: white;
      text-transform: uppercase;

      &::before {
        content: '';
        width: $full;
        flex: 1;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      &[value=thief]::before {
        background-image: url('./images/classes-icons/thief.png');
      }
    }
  }

  > .field[name=race] {
    @extend %flex-visible, %show-value, %full-size, %centering;
    grid-area: race;
    flex-direction: column;
    gap: $tiny-gap;
    color: white;
    text-transform: uppercase;

    &::before {
      content: '';
      width: $full;
      flex: 1;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    &::before {
      background-image: url('./images/classes-icons/thief.png');
    }
  }

  > .field[name=alignment] {
    @extend %flex-visible, %show-value, %full-size, %centering;
    grid-area: alignment;
    flex-direction: column;
    gap: $tiny-gap;
    color: white;
    text-transform: uppercase;

    &::before {
      content: '';
      width: $full;
      flex: 1;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    &::before {
      background-image: url('./images/classes-icons/thief.png');
    }
  }

  > .field[name=bonds] {
    @extend %grid-visible, %field-text;
    color: white;
    grid-area: bonds;
    &::after { content: 'bonds'; }
  }

  // -------------------- main stats --------------------

  > .field[name=damage],
  > .field[name=armor], 
  > .field[name=hp],
  > .field[name='max hp'] {
    @extend %flex-visible, %centering, %title-text, %show-value;
    padding: $small-gap;
    color: white;
  }

  > .field[name=damage] { grid-area: damage; }
  > .field[name=armor] { grid-area: armor; }

  > .field[name=hp],
  > .field[name='max hp'] {
    grid-area: hp;
    &::after { margin: 0.75rem; }
  }

  > .field[name=hp] {
    justify-content: left;
  }

  > .field[name='max hp'] {
    justify-content: right;
  }

  // -------------------- collections --------------------

  > .field[name=moves], > .field[name=gear] {
    @extend %flex-visible;
    overflow-x: scroll;
    padding: $small-gap;
    background: $field-background;

    display: flex;
    gap: $small-gap;

    > * {
      @extend %round;
      aspect-ratio: 1;
      flex: 10 0 auto;
      background: $collection-item-color;
    }
  }

  > .field[name=moves] {
    grid-area: moves;

    .field[name=name] {
      @extend %show-value;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      height: $full;
      padding: $small-gap;
      box-sizing: border-box;

      &::before {
        content: '';
        // TODO background-image: url('images/games/dungeon-world/moves/' attr(value) '.jpg')
      }
    }
  }
  > .field[name=gear] {
    grid-area: gear;

    .field[name=name] {
      @extend %show-value;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      text-align: center;
      height: $full;
      padding: 0.5rem;
      box-sizing: border-box;

      &::before {
        content: '';
        // TODO background-image: url('images/games/dungeon-world/gear/' attr(value) '.jpg')
      }
    }
  }

  // -------------------- settings --------------------

  .settings {
    grid-area: settings;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    -size: 1.5rem;
  }
}
